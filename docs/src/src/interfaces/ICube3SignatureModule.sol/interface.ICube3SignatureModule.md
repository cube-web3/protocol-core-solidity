# ICube3SignatureModule
[Git Source](https://github.com/cube-web3/protocol-core-solidity/blob/c68d80b0bdd3201abf24d2487e2b487b223a629b/src/interfaces/ICube3SignatureModule.sol)

Cube3 Runtime Application Self-Protection (RASP) module for signature verification and
data validation.  The module is responsible for verifying that the payload received by the module was
generated by the Cube3 Risk API, and that the data it contains can be validated by recovering
the signing authority from the signature and the on-chain data.

*Inherits core module functionality from the Cube3Module contract.*

*Module emits no events as a gas-saving measure.*


## Functions
### validateSignature

Validates the signature and data signed by the Integration's
signing authority.

*Emits no events as a gas-saving measure.
Notes:
- If the Registry has been removed from the Router, the module will fallback
to using the backup universal signer.
- Acts like an assertion, will revert under any condition except success.
Requirements:
- `msg.sender` must be the CUBE3 Router.
- The integration's signing authority cannot be the zero address.
- The signer recoverd from the signature must match the Integration's signing
authority.
- The payload's expiration timestamp must not exceed the current block.timestamp.*


```solidity
function validateSignature(
    Structs.TopLevelCallComponents memory topLevelCallComponents,
    bytes calldata signatureModulePayload
)
    external
    returns (bytes32);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`topLevelCallComponents`|`Structs.TopLevelCallComponents`|The details of the top-level call, such as `msg.sender`|
|`signatureModulePayload`|`bytes`|The payload containing the data to be validated by this module.s|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`bytes32`|The hashed MODULE_CALL_SUCCEEDED indicating that signature recovery was succeefull.|


### integrationUserNonce

Retrieves the per-integration nonce of the `account` provided

*The nonce will only be incremented if directed by the module payload.*


```solidity
function integrationUserNonce(address integrationContract, address account) external view returns (uint256);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`integrationContract`|`address`|The integration to retrieve the nonce for.|
|`account`|`address`|The address of the caller to retrieve the nonce for.|


## Structs
### SignatureModulePayloadData
Defines the structure of the Signature Module Payload, ie the data expected by this module.

*This Module Payload is included in the CUBE3 Payload that's passed to the [ProtectionBase-cube3Protected](/lib/protection-solidity/src/ProtectionBase.sol/abstract.ProtectionBase.md#cube3protected)
modifier.*


```solidity
struct SignatureModulePayloadData {
    uint256 expirationTimestamp;
    bool shouldTrackNonce;
    uint256 nonce;
    bytes signature;
}
```

**Properties**

|Name|Type|Description|
|----|----|-----------|
|`expirationTimestamp`|`uint256`|The block timestamp up until which the payload is considered valid.|
|`shouldTrackNonce`|`bool`|A boolean value dictating whether or no the transaction nonce should be accounted for.|
|`nonce`|`uint256`|The transaction nonce for the caller. Will be 0 if `shouldTrackNonce` is `false`.|
|`signature`|`bytes`|ECDSA signature generated by the integration's signing authority.|

